<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ê²Œì‹œíŒ</title>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<script type="text/javascript"
	src="./jquery/jquery.twbsPagination.min.js"></script>

<link rel="stylesheet" type="text/css" href="./css/initial.css">
<link rel="stylesheet" type="text/css" href="./css/table.css">
<link rel="stylesheet" type="text/css" href="./css/button.css">
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">menu</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor03" aria-controls="navbarColor03" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarColor03">
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <a class="nav-link active" href="bbslist.html">Home
            <span class="visually-hidden">(current)</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="bbslikelistfile.html">likeâ¤</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="bbsscraplistfile.html">scrapğŸ”—</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="mypage.html">mypage</a>
        </li>
      </ul>
          <a class="nav-link" href="login.html">log-out</a>
   
    </div>
  </div>
</nav>
	
</head>
<body>
<br>
<br>
<div id="app" class="container">	
	<table style="margin-left: auto; margin-right: auto; margin-top: 3px; margin-bottom: 3px">
		<tr>
				<td style="padding-left: 5px"><select class="custom-select"
					id="_choice" name="choice">
						<option selected>ì„ íƒ</option>
						<option value="title">ì œëª©</option>
						<option value="content">ë‚´ìš©</option>
						<option value="id">ì‘ì„±ì id</option>
						<option value="nickname">ë‹‰ë„¤ì„</option>
						<option value="hashtag">í•´ì‰¬íƒœê·¸</option>
						<option value="address">ì£¼ì†Œ</option>
						<option value="shopname">ê°€ê²Œì´ë¦„</option>
				</select></td>
				
				<td style="padding-left: 5px" class="align-middle">
				<input type="text" class="form-control" id="_search" name="search" placeholder="ê²€ìƒ‰ì–´"></td>
				
				<td style="padding-left: 5px">
					<span><button type="button" class="btn btn-primary" id="btnSearch">ê²€ìƒ‰</button></span>
					
				</td>
		</tr>
	</table>	
	<br>

	<table class="table table-striped table-hover">
		<thead>
			<tr>
				<th>ë²ˆí˜¸</th>
				<th>ì œëª©</th>
	<!-- 			<th>ì‘ì„±ì</th> -->
	 			<th>ë‹‰ë„¤ì„</th> 
			</tr>
		</thead>

		<tbody id="tbody">
		</tbody>

	</table>
	<br><br>

	<div class="container">
		<nav aria-label="Page navigation">
			<ul class="pagination" id="pagination"
				style="justify-content: center"></ul>
		</nav>
	</div>
	<br><br>

	<div align="center">
		<!-- <a href="bbswrite.html">ê¸€ì“°ê¸°</a> -->
		<button type="button" id="writeBtn" class="btn btn-primary">ê¸€ì“°ê¸°</button>
	</div>
	<br><br>

</div>

<script type="text/javascript">
$(document).ready(function () {
	let str = sessionStorage.getItem("login");	
	let json = JSON.parse(str);	
 	let id = JSON.parse(str).id;
		
	
	getBbslist( 0 ); //#1ì—¬ê¸° ìˆëŠ” ì½”ë“œë‚˜ #btnsearch ì•ˆì— ìˆëŠ” ì½”ë“œë‚˜ ì°¨ì´ ì—†ëŠ”ë° ê²€ìƒ‰ í•˜ì§€ ì•Šì€ ëª©ë¡ì´ë‘ ê²€ìƒ‰í•œ ëª©ë¡ì„ ì–´ë–»ê²Œ ë‹¤ë¥´ê²Œ êµ¬í˜„í•¨?
	getBbsCount();
	
	$("#btnSearch").click(function () {
		getBbslist( 0 );
		getBbsCount();		
	});
	 
	 $("#writeBtn").click(function () {
		location.href = "bbsimgupload.html";
	});
	 
	 
	 $("#btnScraplist").click(function (){
		location.href = "bbsscraplist.html" 
	 });
	 
	 
	 $("#btnlikelist").click(function (){
			location.href = "bbslikelistfile.html" 
		 });
	
})

function getBbslist( page ) { //í˜ì´ì§€ëŠ” ë„ëŒ€ì²´ ì–´ë””ì„œ ë‚˜ì˜¤ëŠ”ê±°? ì‚¬ìš©í• ë•Œë§ˆë‹¤ 0ì´ë€ ê°’ì„ pageë¥¼ ëŒ€ì‹ í•´ì„œ ë„£ì–´ì£¼ê¸´ í•¨. ì´ê²Œ ë¬´ìŠ¨ì˜ë¯¸?
	let choice = $("#_choice").val();
	let search = $("#_search").val();
	
	$("#tbody").html(""); // í…Œì´ë¸” ì´ˆê¸°í™”
	$.ajax({
		url:"http://localhost:3000/getBbsListFileSearchPage",
		type:"get",
		data:{ "choice":choice, "search":search, "page":page },
		success:function(list){
			
			$.each(list, function (i, item) {
				
				let str = "<tr>"
							+ "<th>" + (i + 1) + "</th>";
				//#1 ê²€ìƒ‰í•´ì„œ ì•„ë¬´ê²ƒë„ ë‚˜ì˜¤ì§€ ì•Šì•˜ë‹¤ = ê²€ìƒ‰í•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ìƒíƒœì™€ ë™ì¼ì‹œ? ê·¸ë ‡ê²Œ ê²€ìƒ‰í•˜ì§€ ì•Šì•˜ì„ë•Œì˜ ì¼ë°˜ ê²Œì‹œíŒ ëª¨ìŠµ êµ¬í˜„?
			
					str +=	  "<td>"+ "&nbsp;&nbsp;<a href='bbsdetail.html?seq=" + item.seq + "'>" + item.title + "</a></td>"
				
		/* 			str +=	  "<td>" + item.id + "</td>" */
					
					str +=	  "<td>" + item.nickname + "</td>" // null ì´ ëœ¬ë‹¤
					
					
							
						+ "</tr>";	
						
				$("#tbody").append(str);
			});
		},
		error:function(){
			alert('error');	
		}			
	});
}

// ê¸€ì˜ ì´ìˆ˜ë¥¼ ì·¨ë“
function getBbsCount() {
	let choice = $("#_choice").val();
	let search = $("#_search").val();
	
	$.ajax({
		url:"http://localhost:3000/getBbsCount",
		type:"get",
		data:{ "choice":choice, "search":search, "page":0 }, //ì™œ pageë¥¼ 0ì´ë¼ ì„¤ì •?
		success:function(count){ //countê°€ ì–´ë””ì„œ ë‚˜ì˜¤ëŠ”ë°? controllerì— ìˆëŠ” getBbsCountí•¨ìˆ˜ ì‹¤í–‰í•´ì„œ ë‚˜ì˜¨ ê°’?
			//alert(count);
			loadPage(count); 
		},
		error:function(){
			alert('getBbsCount error');
		}		
	});	
}

function loadPage( totalCount ) { // ê¸€ì˜ ì´ìˆ˜		 
	let pageSize = 10;		
	
	let _totalPages = totalCount / 10    // 10 10 3
	if(totalCount % 10 > 0){
		_totalPages++;
	}
	
	$('#pagination').twbsPagination('destroy');	// í˜ì´ì§€ ê°±ì‹ 
	
	$('#pagination').twbsPagination({		
	    totalPages: _totalPages,
	    visiblePages: 10,
	    first:'<span sris-hidden="true">Â«</span>',
	    last:'<span sris-hidden="true">Â»</span>',
	    prev:"ì´ì „",
	    next:"ë‹¤ìŒ",
	    initiateStartPageClick:false,	// onPageClick ìë™í˜¸ì¶œ ë°©ì§€
	    onPageClick: function (event, page) {
	        // alert(page);
	        getBbslist( page - 1 );
	    }
	})
}


</script>

</body>
</html>










